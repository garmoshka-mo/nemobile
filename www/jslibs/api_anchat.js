String.prototype.replaceAll=function(e,t){return this.split(e).join(t)};
String.prototype.escapeHtml=function(){return this.replaceAll("&","&"+"amp;").replaceAll("<","&"+"lt;").replaceAll(">","&"+"gt;").replaceAll('"',"&"+"quot;").replaceAll("'","&"+"#039;")};var Chat=function(e){function i(){if(r!=undefined){if(r.readyState==0||r.readyState==1){r.close()}}}function s(e){if(e.indexOf(" ")>0){var t=e.split(" ",2);switch(t[0]){case"online":if(typeof p=="function")p(t[1]);break}}else{switch(e){case"typing":if(typeof h=="function")h();break;case"begin":if(typeof l=="function")l();l();break;case"end":if(typeof c=="function")c();i();break}}}function o(e){var t=JSON.parse(e.data);switch(t.id){case 0:s(t.msg);break;case-2:d(t.msg.escapeHtml(),t.id);break;default:v(t.msg.escapeHtml(),t.id);break}}function u(e){return e==undefined||typeof e!="function"?function(){}:e}var t=(new Date).getTime();var n="ws://server.anchat.ru:8080/";var r;this.Connect=function(){r=new WebSocket(n);r.onmessage=o;r.onopen=a;r.onclose=f};this.Disconnect=function(){i()};this.Send=function(e){if(r!=undefined&&r.readyState==1)r.send(e.replaceAll("\r\n","").replaceAll("\n","").replaceAll('"','\\"'))};this.Online=function(){if(r!=undefined&&r.readyState==1)r.send("/online")};this.Typing=function(){if((new Date).getTime()-t>2e3){t=(new Date).getTime();if(r!=undefined&&r.readyState==1)r.send("/t")}};var a=u(e.onConnect);var f=u(e.onDisconnect);var l=u(e.onBegin);var c=u(e.onEnd);var h=u(e.onTyping);var p=u(e.onOnline);var d=u(e.onReceiveMyMessage);var v=u(e.onReceiveStrangerMessage);this.onConnect=function(e){a=u(e)};this.onDisconnect=function(e){f=u(e)};this.onBegin=function(e){l=u(e)};this.onEnd=function(e){c=u(e)};this.onTyping=function(e){h=u(e)};this.onOnline=function(e){p=u(e)};this.onReceiveMyMessage=function(e){d=u(e)};this.onReceiveStrangerMessage=function(e){v=u(e)}}