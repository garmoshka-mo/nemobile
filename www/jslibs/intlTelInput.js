function Plugin(t,e){this.element=t,this.options=$.extend({},defaults,e),this._defaults=defaults,this.ns="."+pluginName+id++,this.isGoodBrowser=Boolean(t.setSelectionRange),this.hadInitialPlaceholder=Boolean($(t).attr("placeholder")),this._name=pluginName,this.init()}var pluginName="intlTelInput",id=1,defaults={autoFormat:!0,autoHideDialCode:!0,defaultCountry:"",nationalMode:!1,numberType:"MOBILE",onlyCountries:[],preferredCountries:["us","gb"],responsiveDropdown:!1,utilsScript:""},keys={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90,ZERO:48,NINE:57,SPACE:32,BSPACE:8,DEL:46,CTRL:17,CMD1:91,CMD2:224},windowLoaded=!1;$(window).load(function(){windowLoaded=!0}),Plugin.prototype={init:function(){var t=this;"auto"==this.options.defaultCountry?$.get("http://ipinfo.io",function(e){t.options.defaultCountry=e&&e.country?e.country.toLowerCase():"",t._ready()},"jsonp"):this._ready()},_ready:function(){this.options.nationalMode&&(this.options.autoHideDialCode=!1),navigator.userAgent.match(/IEMobile/i)&&(this.options.autoFormat=!1),window.innerWidth<500&&(this.options.responsiveDropdown=!0),this._processCountryData(),this._generateMarkup(),this._setInitialState(),this._initListeners()},_processCountryData:function(){this._setInstanceCountryData(),this._setPreferredCountries()},_addCountryCode:function(t,e,i){e in this.countryCodes||(this.countryCodes[e]=[]);var n=i||0;this.countryCodes[e][n]=t},_setInstanceCountryData:function(){var t;if(this.options.onlyCountries.length)for(this.countries=[],t=0;t<allCountries.length;t++)-1!=$.inArray(allCountries[t].iso2,this.options.onlyCountries)&&this.countries.push(allCountries[t]);else this.countries=allCountries;for(this.countryCodes={},t=0;t<this.countries.length;t++){var e=this.countries[t];if(this._addCountryCode(e.iso2,e.dialCode,e.priority),e.areaCodes)for(var i=0;i<e.areaCodes.length;i++)this._addCountryCode(e.iso2,e.dialCode+e.areaCodes[i])}},_setPreferredCountries:function(){this.preferredCountries=[];for(var t=0;t<this.options.preferredCountries.length;t++){var e=this.options.preferredCountries[t],i=this._getCountryData(e,!1,!0);i&&this.preferredCountries.push(i)}},_generateMarkup:function(){this.telInput=$(this.element),this.telInput.wrap($("<div>",{"class":"intl-tel-input"}));var t=$("<div>",{"class":"flag-dropdown"}).insertAfter(this.telInput),e=$("<div>",{"class":"selected-flag"}).appendTo(t);this.selectedFlagInner=$("<div>",{"class":"flag"}).appendTo(e),$("<div>",{"class":"arrow"}).appendTo(this.selectedFlagInner),this.countryList=$("<ul>",{"class":"country-list v-hide"}).appendTo(t),this.preferredCountries.length&&(this._appendListItems(this.preferredCountries,"preferred"),$("<li>",{"class":"divider"}).appendTo(this.countryList)),this._appendListItems(this.countries,""),this.dropdownHeight=this.countryList.outerHeight(),this.countryList.removeClass("v-hide").addClass("hide"),this.options.responsiveDropdown&&this.countryList.outerWidth(this.telInput.outerWidth()),this.countryListItems=this.countryList.children(".country")},_appendListItems:function(t,e){for(var i="",n=0;n<t.length;n++){var s=t[n];i+="<li class='country "+e+"' data-dial-code='"+s.dialCode+"' data-country-code='"+s.iso2+"'>",i+="<div class='flag "+s.iso2+"'></div>",i+="<span class='country-name'>"+s.name+"</span>",i+="<span class='dial-code'>+"+s.dialCode+"</span>",i+="</li>"}this.countryList.append(i)},_setInitialState:function(){var t=this.telInput.val();if(this._getDialCode(t))this._updateFlagFromNumber(t);else{var e;e=this.options.defaultCountry?this._getCountryData(this.options.defaultCountry,!1,!1):this.preferredCountries.length?this.preferredCountries[0]:this.countries[0],this._selectFlag(e.iso2),t||this._updateDialCode(e.dialCode,!1)}t&&this._updateVal(t,!1)},_initListeners:function(){var t=this;this._initKeyListeners(),(this.options.autoHideDialCode||this.options.autoFormat)&&this._initFocusListeners();var e=this.telInput.closest("label");e.length&&e.on("click"+this.ns,function(e){t.countryList.hasClass("hide")?t.telInput.focus():e.preventDefault()});var i=this.selectedFlagInner.parent();i.on("click"+this.ns,function(e){t.countryList.hasClass("hide")&&!t.telInput.prop("disabled")&&t._showDropdown()}),this.options.utilsScript&&(windowLoaded?this.loadUtils():$(window).load(function(){t.loadUtils()}))},_initKeyListeners:function(){var t=this;this.options.autoFormat&&this.telInput.on("keypress"+this.ns,function(e){if(e.which>=keys.SPACE&&!e.metaKey&&window.intlTelInputUtils){e.preventDefault();var i=e.which>=keys.ZERO&&e.which<=keys.NINE||e.which==keys.PLUS,n=t.telInput[0],s=t.isGoodBrowser&&n.selectionStart==n.selectionEnd,o=t.telInput.attr("maxlength"),r=o?t.telInput.val().length<o:!0;if(r&&(i||s)){var a=i?String.fromCharCode(e.which):null;t._handleInputKey(a,!0)}i||t.telInput.trigger("invalidkey")}}),this.telInput.on("keyup"+this.ns,function(e){if(e.which==keys.ENTER);else if(t.options.autoFormat&&window.intlTelInputUtils){var i=e.which==keys.CTRL||e.which==keys.CMD1||e.which==keys.CMD2,n=t.telInput[0],s=t.isGoodBrowser&&n.selectionStart==n.selectionEnd,o=t.isGoodBrowser&&n.selectionStart==t.telInput.val().length;if((e.which==keys.DEL&&!o||e.which==keys.BSPACE||i&&s)&&t._handleInputKey(null,i&&o),!t.options.nationalMode){var r=t.telInput.val();if("+"!=r.substr(0,1)){var a=t.isGoodBrowser?n.selectionStart+1:0;t.telInput.val("+"+r),t.isGoodBrowser&&n.setSelectionRange(a,a)}}}else t._updateFlagFromNumber(t.telInput.val())})},_handleInputKey:function(t,e){var i=this.telInput.val(),n=null,s=!1,o=this.telInput[0];if(this.isGoodBrowser){var r=o.selectionEnd,a=i.length;s=r==a,t?(i=i.substr(0,o.selectionStart)+t+i.substring(r,a),s||(n=r+(i.length-a))):n=o.selectionStart}else t&&(i+=t);this.setNumber(i,e),this.isGoodBrowser&&(s&&(n=this.telInput.val().length),o.setSelectionRange(n,n))},_initFocusListeners:function(){var t=this;this.options.autoHideDialCode&&this.telInput.on("mousedown"+this.ns,function(e){t.telInput.is(":focus")||t.telInput.val()||(e.preventDefault(),t.telInput.focus())}),this.telInput.on("focus"+this.ns,function(){var e=t.telInput.val();t.telInput.data("focusVal",e),t.options.autoHideDialCode&&(e||(t._updateVal("+"+t.selectedCountryData.dialCode,!0),t.telInput.one("keypress.plus"+t.ns,function(e){if(e.which==keys.PLUS){var i=t.options.autoFormat&&window.intlTelInputUtils?"+":"";t.telInput.val(i)}}),setTimeout(function(){var e=t.telInput[0];if(t.isGoodBrowser){var i=t.telInput.val().length;e.setSelectionRange(i,i)}})))}),this.telInput.on("blur"+this.ns,function(){if(t.options.autoHideDialCode){var e=t.telInput.val(),i="+"==e.substr(0,1);if(i){var n=t._getNumeric(e);n&&t.selectedCountryData.dialCode!=n||t.telInput.val("")}t.telInput.off("keypress.plus"+t.ns)}t.options.autoFormat&&window.intlTelInputUtils&&t.telInput.val()!=t.telInput.data("focusVal")&&t.telInput.trigger("change")})},_getNumeric:function(t){return t.replace(/\D/g,"")},_showDropdown:function(){this._setDropdownPosition();var t=this.countryList.children(".active");this._highlightListItem(t),this.countryList.removeClass("hide"),this._scrollTo(t),this._bindDropdownListeners(),this.selectedFlagInner.children(".arrow").addClass("up")},_setDropdownPosition:function(){var t=this.telInput.offset().top,e=$(window).scrollTop(),i=t+this.telInput.outerHeight()+this.dropdownHeight<e+$(window).height(),n=t-this.dropdownHeight>e,s=!i&&n?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",s)},_bindDropdownListeners:function(){var t=this;this.countryList.on("mouseover"+this.ns,".country",function(e){t._highlightListItem($(this))}),this.countryList.on("click"+this.ns,".country",function(e){t._selectListItem($(this))});var e=!0;$("html").on("click"+this.ns,function(i){e||t._closeDropdown(),e=!1});var i="",n=null;$(document).on("keydown"+this.ns,function(e){e.preventDefault(),e.which==keys.UP||e.which==keys.DOWN?t._handleUpDownKey(e.which):e.which==keys.ENTER?t._handleEnterKey():e.which==keys.ESC?t._closeDropdown():(e.which>=keys.A&&e.which<=keys.Z||e.which==keys.SPACE)&&(n&&clearTimeout(n),i+=String.fromCharCode(e.which),t._searchForCountry(i),n=setTimeout(function(){i=""},1e3))})},_handleUpDownKey:function(t){var e=this.countryList.children(".highlight").first(),i=t==keys.UP?e.prev():e.next();i.length&&(i.hasClass("divider")&&(i=t==keys.UP?i.prev():i.next()),this._highlightListItem(i),this._scrollTo(i))},_handleEnterKey:function(){var t=this.countryList.children(".highlight").first();t.length&&this._selectListItem(t)},_searchForCountry:function(t){for(var e=0;e<this.countries.length;e++)if(this._startsWith(this.countries[e].name,t)){var i=this.countryList.children("[data-country-code="+this.countries[e].iso2+"]").not(".preferred");this._highlightListItem(i),this._scrollTo(i,!0);break}},_startsWith:function(t,e){return t.substr(0,e.length).toUpperCase()==e},_updateVal:function(t,e){var i;if(this.options.autoFormat&&window.intlTelInputUtils){i=intlTelInputUtils.formatNumber(t,this.selectedCountryData.iso2,e);var n=this.telInput.attr("maxlength");n&&i.length>n&&(i=i.substr(0,n))}else i=t;this.telInput.val(i)},_updateFlagFromNumber:function(t){this.options.nationalMode&&this.selectedCountryData&&"1"==this.selectedCountryData.dialCode&&"+"!=t.substr(0,1)&&(t="+1"+t);var e=this._getDialCode(t);if(e){var i=this.countryCodes[this._getNumeric(e)],n=!1;if(this.selectedCountryData)for(var s=0;s<i.length;s++)i[s]==this.selectedCountryData.iso2&&(n=!0);if(!n||this._isUnknownNanp(t,e))for(var o=0;o<i.length;o++)if(i[o]){this._selectFlag(i[o]);break}}},_isUnknownNanp:function(t,e){return"+1"==e&&this._getNumeric(t).length>=4},_highlightListItem:function(t){this.countryListItems.removeClass("highlight"),t.addClass("highlight")},_getCountryData:function(t,e,i){for(var n=e?allCountries:this.countries,s=0;s<n.length;s++)if(n[s].iso2==t)return n[s];if(i)return null;throw new Error("No country data for '"+t+"'")},_selectFlag:function(t){this.selectedCountryData=this._getCountryData(t,!1,!1),this.selectedFlagInner.attr("class","flag "+t);var e=this.selectedCountryData.name+": +"+this.selectedCountryData.dialCode;this.selectedFlagInner.parent().attr("title",e),this._updatePlaceholder();var i=this.countryListItems.children(".flag."+t).first().parent();this.countryListItems.removeClass("active"),i.addClass("active")},_updatePlaceholder:function(){if(window.intlTelInputUtils&&!this.hadInitialPlaceholder){var t=this.selectedCountryData.iso2,e=intlTelInputUtils.numberType[this.options.numberType||"FIXED_LINE"],i=intlTelInputUtils.getExampleNumber(t,this.options.nationalMode,e);this.telInput.attr("placeholder",i)}},_selectListItem:function(t){var e=t.attr("data-country-code");this._selectFlag(e),this._closeDropdown(),this._updateDialCode(t.attr("data-dial-code"),!0),this.telInput.trigger("change"),this.telInput.focus()},_closeDropdown:function(){this.countryList.addClass("hide"),this.selectedFlagInner.children(".arrow").removeClass("up"),$(document).off(this.ns),$("html").off(this.ns),this.countryList.off(this.ns)},_scrollTo:function(t,e){var i=this.countryList,n=i.height(),s=i.offset().top,o=s+n,r=t.outerHeight(),a=t.offset().top,l=a+r,u=a-s+i.scrollTop(),h=n/2-r/2;if(s>a)e&&(u-=h),i.scrollTop(u);else if(l>o){e&&(u+=h);var d=n-r;i.scrollTop(u-d)}},_updateDialCode:function(t,e){var i,n=this.telInput.val();if(t="+"+t,this.options.nationalMode&&"+"!=n.substr(0,1))i=n;else if(n){var s=this._getDialCode(n);if(s.length>1)i=n.replace(s,t);else{var o="+"!=n.substr(0,1)?$.trim(n):"";i=t+o}}else i=!this.options.autoHideDialCode||e?t:"";this._updateVal(i,e)},_getDialCode:function(t){var e="";if("+"==t.charAt(0))for(var i="",n=0;n<t.length;n++){var s=t.charAt(n);if($.isNumeric(s)&&(i+=s,this.countryCodes[i]&&(e=t.substr(0,n+1)),4==i.length))break}return e},destroy:function(){this._closeDropdown(),this.telInput.off(this.ns),this.selectedFlagInner.parent().off(this.ns),this.telInput.closest("label").off(this.ns);var t=this.telInput.parent();t.before(this.telInput).remove()},getCleanNumber:function(){return window.intlTelInputUtils?intlTelInputUtils.formatNumberE164(this.telInput.val(),this.selectedCountryData.iso2):""},getNumberType:function(){return window.intlTelInputUtils?intlTelInputUtils.getNumberType(this.telInput.val(),this.selectedCountryData.iso2):-99},getSelectedCountryData:function(){return this.selectedCountryData||{}},getValidationError:function(){return window.intlTelInputUtils?intlTelInputUtils.getValidationError(this.telInput.val(),this.selectedCountryData.iso2):-99},isValidNumber:function(){var t=$.trim(this.telInput.val()),e=this.options.nationalMode?this.selectedCountryData.iso2:"",i=/[a-zA-Z]/.test(t);return!i&&window.intlTelInputUtils?intlTelInputUtils.isValidNumber(t,e):!1},loadUtils:function(t){var e=t||this.options.utilsScript;!$.fn[pluginName].loadedUtilsScript&&e&&($.fn[pluginName].loadedUtilsScript=!0,$.ajax({url:e,success:function(){$(".intl-tel-input input").intlTelInput("utilsLoaded")},dataType:"script",cache:!0}))},selectCountry:function(t){this.selectedFlagInner.hasClass(t)||(this._selectFlag(t),this._updateDialCode(this.selectedCountryData.dialCode,!1))},setNumber:function(t,e){this.options.nationalMode||"+"==t.substr(0,1)||(t="+"+t),this._updateFlagFromNumber(t),this._updateVal(t,e)},utilsLoaded:function(){this.options.autoFormat&&this.telInput.val()&&this._updateVal(this.telInput.val()),this._updatePlaceholder()}},$.fn[pluginName]=function(t){var e=arguments;if(void 0===t||"object"==typeof t)return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var i;return this.each(function(){var n=$.data(this,"plugin_"+pluginName);n instanceof Plugin&&"function"==typeof n[t]&&(i=n[t].apply(n,Array.prototype.slice.call(e,1))),"destroy"===t&&$.data(this,"plugin_"+pluginName,null)}),void 0!==i?i:this}},$.fn[pluginName].getCountryData=function(){return allCountries},$.fn[pluginName].setCountryData=function(t){allCountries=t};